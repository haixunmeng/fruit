<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>正在销售</title>

<link href="../../css/easyui.css" rel="stylesheet" type="text/css">
<link href="../../css/icon.css" rel="stylesheet" type="text/css">

<script src="../../js/jquery-2.0.0.min.js"></script>
<script src="../../js/jquery.easyui.min.js"></script>
<script src="../../js/jquery.cookie.js"></script>
<script src="../../js/fruit.js"></script>
<script type="text/javascript">
$(function(){
	$("#selling").datagrid({
		title : "库存信息",
		columns : [[
		            {checkbox:true},
		            {field:'good_id',hidden:'true'},
		            {field:'good_name',title:'商品名称'},
		            {field:'sale_price',title:'售价'},
		            {field:'in_price',title:'进价'},
		            {field:'left_num',title:'库存'},
		            {field:'shelf_time',title:'上架时间'},
		            {field:'in_time',title:'进货时间'},
		            {field:'good_status',title:'状态'}
		]],
		singleSelect:true,
		fitColumns:true,
		checkOnSelect:false,
		toolbar : "#toolbar"
	});
	
	var res = post('/fruit/seller/getAllSellingGoods.do', {token:$.cookie("token"), pageNum:1, pageCount:10});
	if(res != undefined){
		if(res.code == '000004'){
			
			for(var i in res.data){
				if(res.data[i].good_status == "selling"){
					res.data[i].good_status = "正在销售";
				}else if(res.data[i].good_status == "unselling"){
					res.data[i].good_status = "停止销售";
				}else if(res.data[i].good_status == "stockout"){
					res.data[i].good_status = "缺货";
				}
				
				if(res.data[i].value_unit == "kilogram"){
					res.data[i].value_unit = "千克";
				}else if(res.data[i].value_unit == "number"){
					res.data[i].value_unit = "个";
				}else if(res.data[i].value_unit == "box"){
					res.data[i].value_unit = "箱";
				}else if(res.data[i].value_unit == "case"){
					res.data[i].value_unit = "框";
				}else if(res.data[i].value_unit == "bag"){
					res.data[i].value_unit = "袋";
				}
				
				res.data[i].sale_price = res.data[i].sale_price + "/" + res.data[i].value_unit;
				res.data[i].in_price = res.data[i].in_price + "/" + res.data[i].value_unit;
				res.data[i].left_num = res.data[i].left_num + res.data[i].value_unit;
			}
			$("#selling").datagrid('loadData', res.data);
		}else{
			alert(res.msg);
		}
	}
	
	
});

function unshelf_good(){
	var row = $("#selling").datagrid('getSelected');
	var res = post("/fruit/selling/unshelfGood.do", {good_id:row.good_id});
	if(res == undefined){
		if(res.code == '000004'){
			var res = post('/fruit/seller/getAllSellingGoods.do', {token:$.cookie("token"), pageNum:1, pageCount:10});
			if(res != undefined){
				if(res.code == '000004'){
					
					for(var i in res.data){
						if(res.data[i].good_status == "selling"){
							res.data[i].good_status = "正在销售";
						}else if(res.data[i].good_status == "unselling"){
							res.data[i].good_status = "停止销售";
						}else if(res.data[i].good_status == "stockout"){
							res.data[i].good_status = "缺货";
						}
						
						if(res.data[i].value_unit == "kilogram"){
							res.data[i].value_unit = "千克";
						}else if(res.data[i].value_unit == "number"){
							res.data[i].value_unit = "个";
						}else if(res.data[i].value_unit == "box"){
							res.data[i].value_unit = "箱";
						}else if(res.data[i].value_unit == "case"){
							res.data[i].value_unit = "框";
						}else if(res.data[i].value_unit == "bag"){
							res.data[i].value_unit = "袋";
						}
						
						res.data[i].sale_price = res.data[i].sale_price + "/" + res.data[i].value_unit;
						res.data[i].in_price = res.data[i].in_price + "/" + res.data[i].value_unit;
						res.data[i].left_num = res.data[i].left_num + res.data[i].value_unit;
					}
					$("#selling").datagrid('loadData', res.data);
				}else{
					alert(res.msg);
				}
			}
		}else{
			alert(res.msg);
		}
	}
}

function update_sale_price(){
	var row = $("#selling").datagrid('getSelected');
	window.location.href = "/fruit/view/seller/fruit_update_saleprice.html?good_id=" + row.good_id;
}
</script>
</head>
<body>
<table id="selling"></table>
<div id="toolbar">
        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="update_sale_price()">编辑售价</a> 
        <a href="javascript:void(0)" class="easyui-linkbutton" iconcls="icon-add" plain="true" onclick="unshelf_good()">下架</a> 
	</div>
</body>
</html>